比如
 total_hldr_eqy_exc_min_int字段 
 及时性 vs. 准确性 (Speed vs. Accuracy)


在量化交易中，这是一个永恒的权衡。

express (业绩快报):

优点: 快！ 业绩快报通常在正式报告前数周甚至一个月公布。如果你做的是依赖于超前信息的短线Alpha策略，这个速度就是你的生命线。

缺点: 不准！ 快报数据很多是未经审计 (unaudited) 的。这意味着，在发布正式的、经过审计的资产负债表时，这些数字可能会被修正。如果你的策略基于一个会被修改的数字，那么你的回测就会产生巨大的偏差，实盘效果将与回测大相径庭。

balancesheet (资产负债表):

优点: 准！ 这是公司发布的正式财报，是经过会计师事务所审计的（通常情况下），是法律意义上的“事实标准 (Source of Truth)”。它的数据质量最高，最可靠。

缺点: 慢！ 它的公告日期 (ann_date) 会晚于业绩快报。

两种选择，两种策略思路
方案一：准确性优先（最推荐 / 标准方案）
选择： balancesheet (资产负债表)

理由： 对于构建一个长期稳健的、可作为基石的因子库而言，我们总是从最可靠、最干净的“事实标准”数据开始。这能确保你的回测结果是可信的，不会被初步报告和后续修正之间的“数据噪音”所污染。你计算出的ROE_TTM才是基于最终确认的数据，代表了公司的真实基本面。

对你代码的影响： 你的 _calculate_total_equity 函数完全无需修改。 它就是为处理这种“最终版”的、以公告日为事件点的官方数据而设计的。

最佳实践：进一步筛选 balancesheet 数据
在从 balancesheet 接口获取数据时，最好加上一个筛选条件 report_type='1'。

Python

# pro = ts.pro_api()
# df = pro.balancesheet(ts_code='...', report_type='1', ...)
小白解释： report_type='1' 代表合并报表。这可以帮你过滤掉那些“单季度”、“母公司”或“调整前”的报表，只保留最常用、最能代表整个上市公司（包含所有控股子公司）经营状况的合并报表数据，进一步提升数据质量。

方案二：及时性优先（进阶/短线Alpha方案）
选择： 融合 express 和 balancesheet

理由： 追求极致的交易速度，希望在市场对正式报告做出反应之前，就根据快报信息进行交易。

实现逻辑（非常复杂）：

同时获取一只股票的 express 和 balancesheet 数据。

将两份数据合并，并创建一个“优先级”列，例如 balancesheet 优先级为1，express 为2。

以 ann_date 为核心进行排序。当 express 先发布时，采纳它的数据；当后续 balancesheet 发布后，用 balancesheet 的数据覆盖掉之前 express 的数据。

这套逻辑能保证你在第一时间用到最快的信息，并在最准确的信息出来后及时更新。

对你代码的影响： _calculate_total_equity 需要被重写，逻辑会复杂很多。

给你的最终建议
结论：请使用 balancesheet (资产负债表) 作为数据源，你现有的 _calculate_total_equity 函数无需任何修改。

理由如下：

打好基础： 作为量化开发者，我们必须先建立一套基于“事实标准”的、100%可信赖的因子库。这是所有后续研究的基石。

规避风险： 基于未经审计的数据进行交易和回测，会引入不必要的风险和不确定性。对于一个旨在衡量公司长期价值的因子如 ROE_TTM 而言，牺牲一点及时性来换取百分之百的准确性是完全值得的。

由简入繁： 先用标准方案把整个框架搭建完善并跑通。等基础牢固后，如果你确实想开发基于“财报预期差”的短线策略，我们再来挑战方案二那种进阶版的“数据融合”任务。

你的代码是正确的，并且它已经蕴含了处理高质量、官方数据的专业思想。坚持使用 balancesheet，你的因子库将有一个非常坚实的起点。